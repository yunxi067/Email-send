# 功能更新说明 - 手动添加收件人

## 🎉 新增功能

### ✨ 手动添加/编辑收件人

现在您可以：
1. ✅ **批量导入（Excel）** - 上传Excel文件快速导入大量收件人
2. ✅ **手动添加** - 逐个添加收件人信息
3. ✅ **编辑收件人** - 修改已添加的收件人信息
4. ✅ **删除收件人** - 移除不需要的收件人
5. ✅ **混合使用** - 可以先导入Excel，再手动添加或编辑

## 📋 使用方法

### 步骤1：选择导入方式

在"导入收件人"步骤，您会看到两个标签页：

#### 📊 批量导入（Excel）
- 点击"上传Excel文件"
- 选择包含email、name列的Excel文件
- 系统自动解析并添加到收件人列表

#### 👤 手动添加
- 点击"添加收件人"按钮
- 填写姓名、邮箱和附件信息
- 点击"确定"保存

### 步骤2：管理收件人列表

在收件人列表中，每一行都有操作按钮：

- **编辑** 🖊️ - 修改收件人信息（邮箱不可修改）
- **删除** 🗑️ - 移除此收件人（需确认）

### 步骤3：继续添加

在列表顶部有"继续添加"按钮，可以随时添加更多收件人。

## 🎯 使用场景

### 场景1：完全手动添加
适合收件人数量较少（1-20人）的情况：
1. 进入"导入收件人"步骤
2. 切换到"手动添加"标签
3. 逐个添加收件人信息
4. 继续下一步

### 场景2：Excel批量导入
适合收件人数量较多（20+人）的情况：
1. 准备Excel文件（参考examples/recipients.csv）
2. 切换到"批量导入（Excel）"标签
3. 上传Excel文件
4. 继续下一步

### 场景3：混合使用
适合Excel导入后需要补充或修改的情况：
1. 先上传Excel文件批量导入
2. 检查导入的数据
3. 使用"继续添加"按钮补充遗漏的收件人
4. 使用"编辑"按钮修正错误信息
5. 使用"删除"按钮移除不需要的收件人
6. 继续下一步

## 🖼️ 界面说明

### 收件人列表表格

| 列名 | 说明 | 示例 |
|------|------|------|
| 姓名 | 收件人姓名 | 张三 |
| 邮箱 | 收件人邮箱地址 | zhang@example.com |
| 附件 | 个性化附件路径 | contract.pdf |
| 操作 | 编辑/删除按钮 | 🖊️编辑 🗑️删除 |

### 添加/编辑收件人弹窗

**字段说明：**

1. **收件人姓名** *必填*
   - 用于邮件中的{{name}}变量
   - 示例：张三

2. **收件人邮箱** *必填*
   - 必须是有效的邮箱格式
   - 编辑模式下不可修改（防止错乱）
   - 示例：zhang@example.com

3. **个性化附件** *可选*
   - 为此收件人单独添加的附件
   - 填写文件名或路径
   - 留空表示不添加个性化附件
   - 示例：contract_zhang.pdf

## ⚙️ 技术更新

### 前端改进

1. **新增组件**
   - Modal（弹窗）- 用于添加/编辑收件人
   - Tabs（标签页）- 区分Excel导入和手动添加
   - Popconfirm（确认框）- 删除收件人前确认

2. **新增图标**
   - PlusOutlined - 添加按钮
   - EditOutlined - 编辑按钮
   - DeleteOutlined - 删除按钮
   - UserAddOutlined - 手动添加标签图标

3. **状态管理**
   - isAddModalVisible - 控制弹窗显示
   - editingRecipient - 标记编辑模式
   - manualForm - 表单数据管理

4. **表格增强**
   - 添加"操作"列
   - 每行显示编辑/删除按钮
   - 设置固定列宽，优化显示

### 功能特性

1. **数据验证**
   - 邮箱格式验证
   - 必填字段检查
   - 重复邮箱检测

2. **用户体验**
   - 操作提示（成功/失败消息）
   - 删除确认（防止误操作）
   - 编辑时邮箱不可修改（保持数据一致性）

3. **灵活性**
   - Excel和手动添加可以混合使用
   - 支持随时编辑和删除
   - 支持批量导入后微调

## 📝 示例操作流程

### 例1：纯手动添加3个收件人

```
1. 进入"导入收件人"步骤
2. 切换到"手动添加"标签
3. 点击"添加收件人"
   - 姓名：张三
   - 邮箱：zhang@example.com
   - 附件：（留空）
4. 点击"确定"
5. 点击"添加收件人"（第2个）
   - 姓名：李四
   - 邮箱：li@example.com
   - 附件：contract_li.pdf
6. 点击"确定"
7. 点击"添加收件人"（第3个）
   - 姓名：王五
   - 邮箱：wang@example.com
   - 附件：（留空）
8. 点击"确定"
9. 查看列表，确认3个收件人都已添加
10. 点击"下一步"继续
```

### 例2：Excel导入后补充2个收件人

```
1. 进入"导入收件人"步骤
2. 在"批量导入（Excel）"标签上传Excel
3. 系统显示"已导入 50 位收件人"
4. 检查列表，发现遗漏了2个人
5. 点击"继续添加"按钮
6. 填写第1个遗漏的收件人信息，点击"确定"
7. 再次点击"继续添加"
8. 填写第2个遗漏的收件人信息，点击"确定"
9. 列表现在显示"当前共有 52 位收件人"
10. 点击"下一步"继续
```

### 例3：导入后修改错误信息

```
1. 上传Excel后发现某个收件人邮箱错误
2. 在列表中找到该收件人
3. 点击该行的"编辑"按钮
4. 修改邮箱地址（注意：编辑模式下邮箱框是禁用的）
   如果要改邮箱，需要先删除再重新添加
5. 如果只是改姓名或附件，直接修改后点击"确定"
6. 系统显示"收件人信息已更新"
7. 继续下一步
```

### 例4：删除不需要的收件人

```
1. 导入Excel后发现某些收件人不需要发送
2. 在列表中找到该收件人
3. 点击该行的"删除"按钮
4. 弹出确认对话框："确定删除此收件人吗？"
5. 点击"确定"
6. 系统显示"已删除收件人"
7. 该收件人从列表中移除
```

## 🎨 界面预览

### 标签页切换
```
┌─────────────────────────────────────────┐
│ [批量导入（Excel）] [手动添加]          │
├─────────────────────────────────────────┤
│                                         │
│  ℹ️ 手动添加收件人                      │
│  您可以手动添加收件人信息               │
│                                         │
│  [➕ 添加收件人]                        │
│                                         │
└─────────────────────────────────────────┘
```

### 收件人列表
```
┌──────────────────────────────────────────────────────┐
│ ✅ 当前共有 3 位收件人        [➕ 继续添加]         │
├────────┬──────────────────┬────────────┬──────────┤
│ 姓名   │ 邮箱              │ 附件       │ 操作     │
├────────┼──────────────────┼────────────┼──────────┤
│ 张三   │ zhang@example.com │ 无         │🖊️编辑 🗑️删除│
│ 李四   │ li@example.com    │ contract   │🖊️编辑 🗑️删除│
│ 王五   │ wang@example.com  │ 无         │🖊️编辑 🗑️删除│
└────────┴──────────────────┴────────────┴──────────┘
```

### 添加收件人弹窗
```
┌─────────────────────────────────────┐
│  添加收件人                    ✕   │
├─────────────────────────────────────┤
│                                     │
│  收件人姓名 *                       │
│  ┌───────────────────────────────┐ │
│  │ 例如：张三                    │ │
│  └───────────────────────────────┘ │
│                                     │
│  收件人邮箱 *                       │
│  ┌───────────────────────────────┐ │
│  │ 例如：zhang@example.com       │ │
│  └───────────────────────────────┘ │
│                                     │
│  个性化附件（可选）                 │
│  ┌───────────────────────────────┐ │
│  │ 例如：contract.pdf            │ │
│  └───────────────────────────────┘ │
│  填写附件文件名或路径               │
│                                     │
├─────────────────────────────────────┤
│              [取消]    [确定]       │
└─────────────────────────────────────┘
```

## 💡 使用建议

1. **小批量（<10人）** → 推荐手动添加
2. **中批量（10-100人）** → 推荐Excel导入
3. **大批量（>100人）** → 强烈推荐Excel导入
4. **需要微调** → Excel导入 + 手动编辑
5. **测试发送** → 手动添加自己的邮箱

## ⚠️ 注意事项

1. **邮箱唯一性**：同一个邮箱只能添加一次
2. **编辑限制**：编辑模式下邮箱不可修改（需要先删除再添加）
3. **附件路径**：个性化附件需要预先上传到backend/attachments/文件夹
4. **数据保存**：收件人数据仅保存在当前会话，刷新页面会丢失
5. **批量操作**：暂不支持批量删除，需要逐个删除

## 🔮 未来计划

- [ ] 批量删除功能
- [ ] 导入后数据校验报告
- [ ] 收件人分组功能
- [ ] 黑名单/白名单功能
- [ ] 历史记录保存
- [ ] 收件人数据导出

---

**更新日期**: 2024-10-09  
**版本**: v1.1.0

