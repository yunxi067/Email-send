# 邮件群发助手 - 项目结构

## 📁 目录结构

```
邮件群发助手/
│
├── backend/                      # 后端服务（Flask + Python）
│   ├── app.py                   # Flask主应用，包含所有API接口
│   ├── requirements.txt         # Python依赖包列表
│   ├── .gitignore              # 后端Git忽略文件
│   ├── uploads/                # Excel文件上传目录
│   │   └── .gitkeep           # 保持目录存在
│   └── attachments/            # 邮件附件存储目录
│       └── .gitkeep           # 保持目录存在
│
├── frontend/                    # 前端应用（React + TypeScript）
│   ├── src/                    # 源代码目录
│   │   ├── App.tsx            # 主应用组件（核心UI逻辑）
│   │   ├── main.tsx           # React应用入口
│   │   └── index.css          # 全局样式文件
│   ├── public/                 # 静态资源（自动生成）
│   ├── index.html             # HTML模板
│   ├── package.json           # Node.js依赖配置
│   ├── vite.config.ts         # Vite构建配置
│   ├── tsconfig.json          # TypeScript配置
│   └── tsconfig.node.json     # Node环境TS配置
│
├── examples/                    # 示例文件
│   ├── recipients.csv          # 收件人列表示例（CSV格式）
│   └── README.md              # 示例文件使用说明
│
├── README.md                    # 项目主文档（详细说明）
├── 启动说明.txt                # 快速启动指南（中文）
├── 项目结构.md                 # 本文件（项目结构说明）
├── .gitignore                  # Git版本控制忽略文件
├── start_backend.bat           # Windows后端启动脚本
└── start_frontend.bat          # Windows前端启动脚本
```

## 📄 核心文件说明

### 后端文件

#### `backend/app.py`
后端主程序，包含以下功能模块：
- **健康检查** `/api/health` - 服务状态检查
- **SMTP连接测试** `/api/test-connection` - 验证SMTP配置
- **Excel解析** `/api/parse-excel` - 解析上传的Excel文件
- **附件上传** `/api/upload-attachment` - 上传邮件附件
- **批量发送** `/api/send-emails` - 执行邮件群发

主要函数：
- `send_email()` - 单封邮件发送逻辑
- `allowed_file()` - 文件类型验证
- Flask路由处理函数

#### `backend/requirements.txt`
Python依赖包：
```
Flask==3.0.0              # Web框架
flask-cors==4.0.0         # 跨域支持
pandas==2.1.3             # Excel数据处理
openpyxl==3.1.2          # Excel文件读写
xlrd==2.0.1              # 旧版Excel支持
Werkzeug==3.0.1          # WSGI工具库
```

### 前端文件

#### `frontend/src/App.tsx`
前端主组件（约600行），包含：
- **4步骤向导界面**
  1. SMTP配置
  2. 导入收件人
  3. 编写邮件
  4. 发送结果
- **状态管理** - 使用React Hooks
- **API调用** - 使用axios与后端通信
- **UI组件** - Ant Design组件库

核心功能：
- SMTP配置表单和连接测试
- Excel文件上传和解析
- 邮件编辑和预览
- 发送进度和结果展示

#### `frontend/src/index.css`
全局样式定义：
- 渐变背景效果
- 卡片样式
- 结果展示样式
- 响应式布局

#### `frontend/package.json`
前端依赖：
```json
{
  "dependencies": {
    "react": "^18.2.0",           // React核心
    "react-dom": "^18.2.0",       // React DOM
    "antd": "^5.11.5",            // Ant Design UI
    "axios": "^1.6.2",            // HTTP客户端
    "@ant-design/icons": "^5.2.6" // 图标库
  },
  "devDependencies": {
    "vite": "^5.0.8",             // 构建工具
    "typescript": "^5.3.3",        // TypeScript
    "@vitejs/plugin-react": "^4.2.1" // React插件
  }
}
```

### 配置文件

#### `frontend/vite.config.ts`
Vite配置：
- 开发服务器端口：3000
- API代理：/api → http://localhost:5000
- React插件配置

#### `frontend/tsconfig.json`
TypeScript编译配置：
- 目标：ES2020
- 模块：ESNext
- JSX：react-jsx
- 严格模式开启

### 启动脚本

#### `start_backend.bat`
Windows批处理脚本：
- 检查Python环境
- 自动安装依赖
- 启动Flask服务器

#### `start_frontend.bat`
Windows批处理脚本：
- 检查Node.js环境
- 自动安装npm依赖
- 启动Vite开发服务器

### 示例文件

#### `examples/recipients.csv`
收件人列表模板：
```csv
email,name,attachment
zhang@example.com,张三,contract_001.pdf
li@example.com,李四,contract_002.pdf
```

包含必需字段和可选字段示例。

## 🔄 数据流程

```
用户浏览器 (localhost:3000)
    ↓ HTTP请求
Vite开发服务器
    ↓ API代理 (/api/*)
Flask后端服务 (localhost:5000)
    ↓
[处理逻辑]
├─ Excel解析 (pandas)
├─ 文件上传 (werkzeug)
└─ SMTP发送 (smtplib)
    ↓
邮件服务器 (SMTP)
    ↓
收件人邮箱
```

## 📦 部署目录

运行时会生成以下目录：

```
backend/
├── uploads/              # Excel文件存储
│   └── 20241009_143022_recipients.xlsx
└── attachments/          # 附件存储
    ├── document.pdf
    └── contract.pdf

frontend/
├── node_modules/         # npm依赖包（10000+文件）
└── dist/                # 生产构建输出（npm run build后）
```

## 🎯 核心技术点

### 后端技术
1. **Flask路由系统** - RESTful API设计
2. **Pandas数据处理** - Excel文件解析
3. **SMTP协议** - 邮件发送实现
4. **文件上传处理** - Werkzeug文件处理
5. **CORS跨域** - 前后端分离

### 前端技术
1. **React Hooks** - 函数式组件状态管理
2. **TypeScript** - 类型安全
3. **Ant Design** - 企业级UI组件
4. **Axios** - HTTP请求封装
5. **Steps组件** - 多步骤向导

### 安全特性
1. 文件类型验证
2. 文件大小限制（50MB）
3. 安全文件名处理
4. SMTP认证
5. 错误处理和日志

## 📊 代码统计

| 类型 | 文件数 | 代码行数 |
|------|--------|----------|
| Python | 1 | ~250行 |
| TypeScript/TSX | 3 | ~650行 |
| CSS | 1 | ~100行 |
| 配置文件 | 5 | ~100行 |
| 文档 | 4 | ~500行 |
| **总计** | **14** | **~1600行** |

## 🚀 扩展建议

如需扩展功能，可以考虑：

### 后端扩展
- [ ] 添加数据库支持（SQLite/MySQL）
- [ ] 实现发送队列和定时任务
- [ ] 添加邮件模板管理
- [ ] 实现发送日志记录
- [ ] 添加用户认证系统

### 前端扩展
- [ ] 添加邮件模板编辑器
- [ ] 实现富文本编辑器
- [ ] 添加发送历史查询
- [ ] 实现实时发送进度（WebSocket）
- [ ] 添加统计图表展示

### 功能扩展
- [ ] 支持定时发送
- [ ] 支持邮件追踪（已读回执）
- [ ] 支持多个SMTP账号轮换
- [ ] 支持邮件预览功能
- [ ] 支持HTML邮件模板

## 📝 维护建议

1. **定期更新依赖包**
   ```bash
   # 后端
   pip list --outdated
   pip install --upgrade package_name
   
   # 前端
   npm outdated
   npm update
   ```

2. **代码审查重点**
   - SMTP密码安全存储
   - 文件上传安全性
   - 错误处理完整性
   - API接口权限控制

3. **性能优化**
   - 大量邮件发送使用队列
   - Excel文件分块读取
   - 前端虚拟列表优化
   - 静态资源CDN部署

## 🆘 问题排查

### 后端问题
- 查看控制台错误输出
- 检查`backend/`目录权限
- 验证Python包是否完整安装

### 前端问题
- 查看浏览器控制台（F12）
- 检查Network标签API调用
- 清除浏览器缓存

### 网络问题
- 检查防火墙设置
- 验证端口占用情况
- 测试SMTP服务器连通性

---

**最后更新**: 2024-10-09  
**项目版本**: v1.0.0

