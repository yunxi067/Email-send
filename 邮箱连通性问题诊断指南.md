# 📧 邮箱连通性问题诊断指南

## 🔧 问题修复说明

项目已经增强了邮箱连通性测试功能，主要改进包括：

### 1. 增强的错误处理和诊断
- ✅ 添加了详细的错误日志记录
- ✅ 提供具体的错误原因和解决建议
- ✅ 新增智能诊断功能，自动检测配置问题

### 2. 改进的连接逻辑
- ✅ 优化了SSL/TLS连接处理
- ✅ 增加了网络连通性预检查
- ✅ 提供更长的超时时间（15秒）

### 3. 智能诊断功能
在SMTP配置页面新增了"智能诊断"按钮，可以：
- 检测网络连接是否正常
- 验证端口与加密方式是否匹配
- 提供针对性的配置建议

## 🚨 常见问题及解决方案

### 问题1：认证失败（用户名或密码错误）

**症状**：
- 提示"认证失败：用户名或密码错误"
- 配置看起来正确但无法连接

**解决方案**：

#### QQ邮箱
1. **必须使用授权码**，不是QQ密码
2. 获取授权码步骤：
   - 登录QQ邮箱网页版
   - 设置 → 账户 → POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务
   - 开启"SMTP服务"
   - 生成授权码（保存好，只显示一次）
3. 推荐配置：
   ```
   SMTP服务器: smtp.qq.com
   端口: 465
   SSL: 开启
   TLS: 关闭
   ```

#### 163邮箱
1. **必须使用授权码**，不是登录密码
2. 获取授权码步骤：
   - 登录163邮箱网页版
   - 设置 → POP3/SMTP/IMAP
   - 开启SMTP服务
   - 设置授权密码
3. 推荐配置：
   ```
   SMTP服务器: smtp.163.com
   端口: 465
   SSL: 开启
   TLS: 关闭
   ```

#### Gmail
1. **需要使用应用专用密码**
2. 获取步骤：
   - 开启两步验证
   - 在安全设置中生成应用专用密码
3. 推荐配置：
   ```
   SMTP服务器: smtp.gmail.com
   端口: 587
   SSL: 关闭
   TLS: 开启
   ```

### 问题2：端口配置错误

**症状**：
- 连接超时或被拒绝
- SSL/TLS错误

**解决方案**：

| 端口 | SSL | TLS | 说明 |
|------|-----|-----|------|
| 465  | ✅  | ❌  | SSL加密端口（推荐） |
| 587  | ❌  | ✅  | TLS加密端口 |
| 25   | ❌  | ❌  | 无加密（不推荐） |

### 问题3：网络连接问题

**症状**：
- 无法连接到服务器
- 连接超时

**可能原因及解决方案**：

1. **防火墙阻止**
   - Windows防火墙可能阻止了Python访问网络
   - 解决：允许Python通过防火墙

2. **公司/学校网络限制**
   - 某些网络环境限制SMTP端口
   - 解决：尝试使用其他网络或VPN

3. **杀毒软件拦截**
   - 某些杀毒软件会拦截邮件发送
   - 解决：暂时关闭杀毒软件的邮件扫描功能

### 问题4：SSL证书问题

**症状**：
- SSL验证失败
- 证书错误

**解决方案**：
1. 确保系统时间正确
2. 更新Python的证书包：
   ```bash
   pip install --upgrade certifi
   ```
3. 如果是自签名证书的企业邮箱，可能需要特殊配置

## 🔍 如何使用智能诊断

1. 在SMTP配置页面填写基本信息
2. 点击"智能诊断"按钮
3. 查看诊断结果：
   - ✅ 绿色：配置正确
   - ⚠️ 黄色：可能有问题
   - ❌ 红色：确定有错误
4. 根据建议调整配置

## 💡 最佳实践

1. **先使用智能诊断**：在测试连接前，先运行诊断查看配置建议
2. **保存正确配置**：测试成功后，记录下配置信息
3. **使用授权码**：大部分邮箱都需要授权码而非密码
4. **选择正确的端口和加密方式**：465+SSL 或 587+TLS

## 📝 调试提示

如果仍然无法连接，可以：

1. **查看后端控制台**：
   - 后端会输出详细的调试信息
   - 查找 `[DEBUG]` 和 `[ERROR]` 标记

2. **逐步排查**：
   - 先确认网络能ping通邮件服务器
   - 再确认端口是否开放
   - 最后检查认证信息

3. **常用测试命令**（在命令提示符中）：
   ```bash
   # 测试网络连接
   ping smtp.qq.com
   
   # 测试端口连接（需要telnet）
   telnet smtp.qq.com 465
   ```

## 🆘 需要更多帮助？

如果按照以上步骤仍无法解决问题：

1. 收集以下信息：
   - 邮箱服务商
   - 使用的端口
   - 错误提示截图
   - 后端控制台输出

2. 检查邮箱服务商的官方文档，确认：
   - SMTP服务是否已开启
   - 是否有IP白名单限制
   - 是否有发送频率限制

3. 尝试在其他邮件客户端（如Outlook）中使用相同配置，验证配置是否正确

## 更新记录

- 2024-10-10：增强错误处理，添加智能诊断功能
- 改进SSL/TLS连接逻辑
- 添加详细的错误提示和解决建议
- 支持更多邮箱服务商的特定配置建议
